---
title: "Onderzoek Telefoongedrag"
author: "Michele Radaelli"
date: "26 februari 2016"
output: html_document
---
# Onderzoek Telefoongedrag

### Inleiding
In dit onderzoek zal ik kijken naar het telefoongedrag van mijn vrouw en 3 aanbevelingen doen op basis van inzichten en conclusies die ik uit het onderzoek verkrijg.

### Data inlezen, opschonen en opknippen
```{r warning=F,message=F}
library(xlsx)
# complete_data <- read.xlsx("./TelefoonGegevensFederica.xlsx", 1, header=TRUE, stringsAsFactors = FALSE,
#                            colClasses = "character")
complete_data <- read.csv("./TelefoonGegevensFederica.csv", header=TRUE, stringsAsFactors = FALSE,
                           colClasses = "character")
head(complete_data)
```

```{r warning=F,message=F}
library(lubridate)
complete_data_split <- split(complete_data, complete_data$field3)

Gesprekken <- complete_data_split$Gesprek[, c(1,2,5,6,8)]
colnames(Gesprekken) <- c("Datum", "Tijd", "Telnummer", "Gespreksduur", "Prijs")

Gesprekken$Uur <- factor(substr(Gesprekken$Tijd, 1, 2), ordered = TRUE,
                          levels = c("00", "08", "09", "10", "11","12","13","14","15","16","17","18","19","20","21"))
                           #levels = order(unique(substr(Gesprekken$Tijd, 1, 2))))
Gesprekken$Gespreksduur <-  round(as.numeric(Gesprekken$Gespreksduur) * 86400)

Internet <- complete_data_split$Internet[, c(1,2,5,6,8)]
colnames(Internet) <- c("Datum", "Tijd", "Verbruik", "Eenheid", "Prijs")

Internet$Uur <- factor(substr(Internet$Tijd, 1, 2), ordered = TRUE,
                          levels = c("00", "01","02","03","04","05","06","07", "08", "09", "10", "11","12","13","14","15","16","17","18","19","20","21", "22", "23"))
Internet$Eenheid <- gsub(")", "", Internet$Eenheid)
Internet$Verbruik <- gsub("\\(", "", Internet$Verbruik)
Internet$Verbruik <- as.numeric(Internet$Verbruik) / 1024

head(Gesprekken)
head(Internet)
```

### Analyse per weekdag (Gesprek vs. Internet)
```{r warning=F,message=F}
library(ggplot2)
Gesprekken$Weekdag <- factor(weekdays(as.Date(Gesprekken$Datum)), ordered = TRUE,
                             levels = c("Monday", "Tuesday", "Wednesday",
                                        "Thursday", "Friday", "Saturday", "Sunday"))
Gesprekken_gem_dag <- aggregate(as.numeric(Gesprekken$Gespreksduur), by=list(Gesprekken$Weekdag), FUN="mean")
colnames(Gesprekken_gem_dag) <- c("Weekdag", "GemDag")

plot1 <-
  ggplot(Gesprekken, aes(Weekdag, Gespreksduur)) +  geom_boxplot() + ylim(c(0, 300)) +
  geom_hline(yintercept = mean(as.numeric(Gesprekken$Gespreksduur)), colour = "red") +
  ylab("Gemiddelde Gesprekstijd in s") + xlab("") +
  ggtitle("Gemiddelde Gesprekstijd per Dag")

Internet$Weekdag <- factor(weekdays(as.Date(Internet$Datum)), ordered = TRUE,
                           levels = c("Monday", "Tuesday", "Wednesday",
                                      "Thursday", "Friday", "Saturday", "Sunday"))
Internet_gem_dag <- aggregate(as.numeric(Internet$Verbruik), by=list(Internet$Weekdag), FUN="mean")
colnames(Internet_gem_dag) <- c("Weekdag", "GemDag")

plot2 <-
  ggplot(Internet, aes(Weekdag, Verbruik)) +  geom_boxplot() + ylim(c(0, 5)) +
  geom_hline(yintercept = mean(as.numeric(Internet$Verbruik)), colour = "red") +
  ylab("Gemiddeld Verbruik in MB") + xlab("") +
  ggtitle("Gemiddeld Verbruik per Dag")

library(Rmisc)
multiplot(plot1, plot2, cols=2)
```

### Analyse per maand (Gesprek vs. Internet)
```{r warning=F,message=F}
Gesprekken$Maand <- factor(month(as.Date(Gesprekken$Datum)), ordered = TRUE,
                           levels = c(6, 7, 8, 9, 10, 11, 12, 1))
Gesprekken_maand <- aggregate(as.numeric(Gesprekken$Gespreksduur), by=list(Gesprekken$Maand), FUN="sum")
colnames(Gesprekken_maand) <- c("Maand", "GesprMaand")

plot3 <- 
  ggplot(Gesprekken_maand, aes(x = Gesprekken_maand$Maand, y = Gesprekken_maand$GesprMaand)) + 
  geom_bar(stat = "identity") + ylab("Gesprekstijd in s") + xlab("") + 
  ggtitle("Gesprekstijd per Maand")

Internet$Maand <- factor(month(as.Date(Internet$Datum)), ordered = TRUE,
                           levels = c(6, 7, 8, 9, 10, 11, 12, 1))
Internet_maand <- aggregate(as.numeric(Internet$Verbruik), by=list(Internet$Maand), FUN="sum")
colnames(Internet_maand) <- c("Maand", "VerbrMaand")

Internet_maand$bundle <- c(rep(200, 6), rep(500, 2))

plot4 <- 
  ggplot(Internet_maand, aes(x = Maand, y = VerbrMaand)) +
  geom_bar(stat = "identity") + ylab("Verbruik in MB") +
  geom_errorbar(aes(y = bundle, ymin = bundle, ymax = bundle), colour = "red") + xlab("") + 
  ggtitle("Verbruik per Maand")

multiplot(plot3, plot4, cols=2)
# correggere posizione e ordine (da maggio a febbraio) dei mesi (aggiungere nome del mese?), statistica? Colori? Aggiungere per i mesi 5-9 una barra alta 200mb e da 10-2 500 mb (abbonamento cambiato) (primo abb era 100 minuti + 200 mb, secondo 100 min + 500 mb. altre possibilita: https://www.simyo.nl/sim-only/bestellen )
# prezzo pagato in piu?

```

### Analyse per uur/dagdeel (Gesprek vs. Internet)
```{r warning=F,message=F}
#Fare un analisi del momento del giorno in cui vengono usati piu dati e fatti piu secondi di chiamata
Gesprekken_gem_uur <- aggregate(as.numeric(Gesprekken$Gespreksduur), by=list(Gesprekken$Uur), FUN="mean")
colnames(Gesprekken_gem_uur) <- c("Tijd", "GemUur")

plot5 <-
  ggplot(Gesprekken, aes(Uur, Gespreksduur)) + geom_boxplot() + geom_jitter() + ylim(c(0, 300)) +
  geom_hline(yintercept = mean(as.numeric(Gesprekken$Gespreksduur)), colour = "red") +
  ylab("Gemiddelde Gesprekstijd in s") + xlab("") +
  ggtitle("Gemiddelde Gesprekstijd per Uur")


Internet_gem_uur <- aggregate(as.numeric(Internet$Verbruik), by=list(Internet$Uur), FUN="mean")
colnames(Internet_gem_uur) <- c("Tijd", "GemUur")

plot6 <-
  ggplot(Internet, aes(Uur, Verbruik)) + geom_boxplot() + geom_jitter() + ylim(c(0, 2)) +
  geom_hline(yintercept = mean(as.numeric(Internet$Verbruik)), colour = "red") +
  ylab("Gemiddeld Verbruik in MB") + xlab("") +
  ggtitle("Gemiddeld Verbruik per Uur")

multiplot(plot5, plot6, cols=2)

#aggiungere due colori per i mesi 200 mb en 500 mb
```

### Analyse voorspelling komende maanden (Gesprek vs. Internet)
```{r warning=F,message=F}
#Fate un analisi per prevedere i prossimi mesi quanto sar?? il consumo di dati/minuti e paragonarlo all'abbonamento attuale per vedere se andr?? ancora bene
#library(forecast)
#ts() #time series object
Internet_per_dag <- aggregate(Internet$Verbruik, by = list(as.Date(Internet$Datum, format = "%d/%m/%y")), FUN = "sum")

Time_series <- ts(Internet_per_dag$x)

plot(Time_series)


#model_arima <- arima() #arima modelling
#model_ets <- ets() #ets modelling

#http://robjhyndman.com/talks/MelbourneRUG.pdf

#forecast(model_arima, 120) #forecasting ahead
```

### Analyse meest gebelde nummers
```{r warning=F,message=F}
Tijd_per_nummer <- aggregate(Gesprekken$Gespreksduur, by = list(substr(Gesprekken$Telnummer, 1,5), month(Gesprekken$Datum)), 'sum')
colnames(Tijd_per_nummer) <- c("Nummer", "Maand", "SomTijd")
Tijd_per_nummer <- arrange(Tijd_per_nummer, desc(SomTijd))[1:10,]

plot7 <- 
  ggplot(Tijd_per_nummer, aes(x = Nummer, y = SomTijd)) + 
  geom_bar(stat = "identity") + ylab("Beltijd in s") + xlab("") + 
  ggtitle("Beltijd per Nummer")
plot7
```



